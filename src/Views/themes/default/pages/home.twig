{% extends 'layout.twig' %}

{% block title %}{{ shop.shop_name }} - Home{% endblock %}

{% block head %}
    {% set allowed_hero_types = ['banner', 'slider', 'headline'] %}
    {% set resolved_hero_type = hero_type ?? shop.hero_type ?? 'banner' %}
    {% if resolved_hero_type not in allowed_hero_types %}
        {% set resolved_hero_type = '' %}
    {% endif %}
    {% set resolved_settings = hero_settings[resolved_hero_type] ?? {} %}
    {% set hero_content = resolved_settings.content ?? {} %}
    {% set preload_image = null %}
    {% if resolved_hero_type == 'banner' and hero_content.title and hero_content.image %}
        {% set preload_image = hero_content.image %}
    {% elseif resolved_hero_type == 'slider' and resolved_settings.slides is defined and resolved_settings.slides|length > 0 %}
        {% set first_slide = resolved_settings.slides|first %}
        {% if first_slide.image %}
            {% set preload_image = first_slide.image %}
        {% endif %}
    {% endif %}
    {% if preload_image %}
        <link rel="preload" as="image" href="/media/{{ preload_image }}">
    {% endif %}
{% endblock %}

{% block content %}
{% set sections = home_sections ?? [] %}
{% set content = home_content ?? {} %}
{% set hero_enabled = false %}
{% for section in sections %}
    {% if section.type == 'hero' and section.enabled %}
        {% set hero_enabled = true %}
    {% endif %}
{% endfor %}

<div class="space-y-12 p-4 md:p-8 w-full max-w-7xl mx-auto">
    {% if not hero_enabled %}
        {% include 'partials/hero/index.twig' with {
            hero_settings: {},
            shop: shop,
            hero_type: ''
        } only %}
    {% endif %}

    {% set featured_products = [
        { 'name': 'Classic Cotton T-Shirt', 'slug': 'classic-cotton-tshirt', 'price': '₹899', 'badge': 'New' },
        { 'name': 'Wireless Earbuds', 'slug': 'wireless-earbuds', 'price': '₹2,499', 'badge': 'Hot' },
        { 'name': 'Minimal Backpack', 'slug': 'minimal-backpack', 'price': '₹1,799', 'badge': 'Limited' },
        { 'name': 'Ceramic Coffee Mug', 'slug': 'ceramic-coffee-mug', 'price': '₹499', 'badge': 'Bestseller' },
        { 'name': 'Smart Fitness Band', 'slug': 'smart-fitness-band', 'price': '₹3,199', 'badge': 'Trending' },
        { 'name': 'Wooden Desk Organizer', 'slug': 'wooden-desk-organizer', 'price': '₹1,099', 'badge': 'Eco' },
        { 'name': 'Studio Headphones', 'slug': 'studio-headphones', 'price': '₹4,699', 'badge': 'Top Rated' },
        { 'name': 'Scented Candle Set', 'slug': 'scented-candle-set', 'price': '₹1,299', 'badge': 'Gift' }
    ] %}
    {% set category_labels = ['Electronics', 'Fashion', 'Home & Living', 'Sports'] %}
    {% set popular_products = [
        { 'name': 'Smart Fitness Watch', 'slug': 'smart-fitness-watch', 'price': '₹3,299', 'badge': 'Popular' },
        { 'name': 'Organic Skincare Kit', 'slug': 'organic-skincare-kit', 'price': '₹1,299', 'badge': 'New' },
        { 'name': 'Noise-Canceling Headphones', 'slug': 'noise-canceling-headphones', 'price': '₹5,499', 'badge': 'Trending' },
        { 'name': 'Eco Water Bottle', 'slug': 'eco-water-bottle', 'price': '₹699', 'badge': 'New' },
        { 'name': 'Minimal Desk Lamp', 'slug': 'minimal-desk-lamp', 'price': '₹1,499', 'badge': 'Popular' },
        { 'name': 'Travel Organizer Kit', 'slug': 'travel-organizer-kit', 'price': '₹899', 'badge': 'New' },
        { 'name': 'Bluetooth Speaker', 'slug': 'bluetooth-speaker', 'price': '₹2,699', 'badge': 'Trending' },
        { 'name': 'Daily Planner', 'slug': 'daily-planner', 'price': '₹499', 'badge': 'Popular' }
    ] %}

    {% for section in sections %}
        {% set type = section.type ?? '' %}
        {% if section.enabled %}
            {% if type == 'hero' %}
                {% include 'partials/home/hero.twig' with {
                    hero_settings: hero_settings ?? {},
                    shop: shop,
                    hero_type: hero_type ?? null
                } only %}
            {% elseif type == 'about' %}
                {% include 'partials/home/about.twig' with {
                    content: content,
                    shop: shop
                } only %}
            {% elseif type == 'featured_products' %}
                {% include 'partials/home/featured_products.twig' with {
                    content: content,
                    section: section,
                    featured_products: featured_products
                } only %}
            {% elseif type == 'categories' %}
                {% include 'partials/home/categories.twig' with {
                    content: content,
                    section: section,
                    category_labels: category_labels
                } only %}
            {% elseif type == 'popular_new' %}
                {% include 'partials/home/popular_new.twig' with {
                    content: content,
                    section: section,
                    popular_products: popular_products
                } only %}
            {% elseif type == 'promo' %}
                {% include 'partials/home/promo.twig' with {
                    content: content
                } only %}
            {% elseif type == 'testimonials' %}
                {% include 'partials/home/testimonials.twig' with {
                    content: content
                } only %}
            {% elseif type == 'newsletter' %}
                {% include 'partials/home/newsletter.twig' with {
                    content: content,
                    csrf_token: csrf_token
                } only %}
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
{% endblock %}
